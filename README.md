# Бот для технической поддержки KFC
Предназначен для упрощения работы тех поддержки.  
Управление ключевыми параметрами работы бота осуществляется через админ-панель.

## Бот умеет:
- Запускать синхронизацию по ресторанам, как точечно, так и массово.
- Запускать синхронизация по транзитным серверам.
- Формировать отчет по результату синхронизации.
- Сканировать почту для поиска информации по задачам.
- Выводить краткое и полное описание задачи.
- Сообщать о задачах с критическим приоритетом.
- Осуществлять контроль доступа к функциям бота.

## Требования:
- Python >= 3.11
- Установленный переменные окружения

## Доступные переменные окружения:
- Переменные окружения приложения (.env).
  - Обязательные:
    ```dotenv
     SERET_KEY: str - уникальный секретный ключь приложения. Сгенерировать можно здесь.
	    TG_BOT_TOKEN: str - токен телеграм бота. Получить можно тут https://t.me/BotFather
	    TG_BOT_ADMIN: int - телеграм id главного администратора бота.
	
	    # для работы с xml интерфейсом
	    XML_LOGIN: str - логин для xml интерфейсов серверов R-Keeper.
	    XML_PASSWORD: str - пароль для xml интерфейсов серверов R-Keeper.
	
	    # настройки почты.
	    MAIL_LOGIN: str - логин от почтового ящика с письмами GSD.
	    MAIL_PASSWORD: str - пароль от почтового ящика с письмами GSD.
	    MAIL_IMAP_SERVER: str -  почтовый сервер IMAP.
    ```
    
  - Не обязательные:
    ```dotenv
        DB_URL: str - строка подключения для базы приложения. Значение по умолчанию: sqlite:///db.sqlite3.
        ALLOWED_HOSTS: list - список доверительных узлов.Значение по умолчанию: '127.0.0.1','localhost'.
        DEBUG: bool - отладочный режим. Значение по умолчанию: False.
        CSRF_TRUSTED_ORIGINS: list - Список доверенных источников небезопасных запросов (например, POST). Значение по умолчанию: 'http://localhost:1337'
	       TASK_ESCALATION: int -  время первой  и второй эскалации для задач в минутах. Значение по умолчанию 10.
        TASK_DEADLINE: int - время dedline для задачи в минутах. Значение умолчанию 120.  
    
        # настройка статики
        STATIC_URL: str - url префикс для статики приложения. Значение по умолчанию /static/.
        STATIC_ROOT: str - путь для хранения статики на сервере. Значение по умолчанию: папка static в корне проекта.
    
        # Rollbar
        ROLLBAR_ACCESS_TOKEN: str - токен проекта внутри Rollbar. Значение по умолчанию не задано.
        ROLLBAR_ENV: str - окружение проекта Rollbar(dev/production). Занчение по умолчанию: dev.
    ```
  - Для настройки БД в докере(.env.db):
    ```dotenv
    POSTGRES_USER: str - имя пользователя БД.
    POSTGRES_PASSWORD: str - пароль БД.
    POSTGRES_NAME: str - имя БД.
    ```

## Список команд бота
```text
Подрядчики:
	/support_help - Запросить помощь у инженеров. -> Требуется группа доступа которая начинается со слов Подрядчик

Администраторы:
	/scheduler_jobs - Список задач шедулера
	/close_scheduler_job - Завершить задачу щедулера.
	Все остальные команды

Задачи(отдельная группа для работы с задачами)
	/my_active_tasks - Посмотреть список своих задач взятых в работу
	/get_task - Получить все новые задачи
	/close_task - Закрыть открытую задачу
	
Инженерные:
	Все инженеры (Старшие, Ведущие, Обычные):
		/on_shift - Заступить на смену(получать задачи)
		/end_shift - Закончить смену
		/break_start - Уйти на перерыв(Не получать задачи)
		/break_stop - Завершить перерыв
		/sync_tr - синхронизация транзитов -> Требуется дополнительное право "Синхронизация"
		/sync_rests - синхронизация ресторанво -> Требуется дополнительное право "Синхронизация"
	Старшие и ведущие инженеры:	
		/new_tasks - Просмотр не назначенных задач. 
```